<% cache [ bubble, bubble.bucket ] do %>
  <%= turbo_frame_tag bubble, :assignment do %>
    <dialog class="popup panel flex-column align-start gap-half fill-white shadow" data-dialog-target="dialog">
      <strong class="popup__title margin-block-start-half pad-inline-half txt-nowrap">Assign this toâ€¦</strong>

      <%= form_with url: bubble_assignments_path(bubble), class: "flex flex-column full-width popup__list", data: { controller: "form" } do |form| %>
        <% bubble.bucket.users.active.sort_by(&:name).each do |user| %>
          <div class="btn popup__item">
            <%= form.check_box "assignee_id[]", {
              checked: bubble.assigned_to?(user),
              data: { action: "change->form#submit" },
              id: dom_id(user, :assign),
              include_hidden: false,
            }, user.id %>

            <%= form.label "assignee_id[]", user.name, for: dom_id(user, :assign), class: "overflow-ellipsis" %>
            <%= icon_tag "check", size: 18, class: "checked flex-item-justify-end" %>
          </div>
        <% end %>
      <% end %>
    </dialog>
  <% end %>
<% end %>
